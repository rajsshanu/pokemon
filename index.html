<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retro Pok√©mon Personality Quiz ‚Äî Card Download Fix</title>

  <!-- Pixel font (from Quiz) -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">

  <!-- html2canvas library for card download (from Quiz) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    /* --- Background Styles --- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body,
    html {
      height: 100%;
      overflow: hidden;
      font-family: monospace;
    }

    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(180deg,
          #1a1a2e 0%,
          #16213e 15%,
          #0f3460 30%,
          #533483 45%,
          #e94560 65%,
          #f5af19 85%,
          #f12711 100%);
      transition: all 2s ease;
      animation: skyGradient 20s ease-in-out infinite alternate;
      /* --- Added from Quiz for centering the content --- */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes skyGradient {
      0% {
        background: linear-gradient(180deg,
            #1a1a2e 0%,
            #16213e 15%,
            #0f3460 30%,
            #533483 45%,
            #e94560 65%,
            #f5af19 85%,
            #f12711 100%);
      }

      25% {
        background: linear-gradient(180deg,
            #667eea 0%,
            #764ba2 20%,
            #f093fb 40%,
            #f5576c 60%,
            #4facfe 80%,
            #00f2fe 100%);
      }

      50% {
        background: linear-gradient(180deg,
            #fa709a 0%,
            #fee140 20%,
            #667eea 40%,
            #764ba2 60%,
            #f093fb 80%,
            #f5576c 100%);
      }

      75% {
        background: linear-gradient(180deg,
            #a8edea 0%,
            #fed6e3 20%,
            #f7797d 40%,
            #fbd786 60%,
            #c6ffdd 80%,
            #fbd786 100%);
      }

      100% {
        background: linear-gradient(180deg,
            #667eea 0%,
            #764ba2 30%,
            #f12711 50%,
            #f5af19 70%,
            #ffecd2 90%,
            #fcb69f 100%);
      }
    }

    .stars {
      position: absolute;
      width: 100%;
      height: 70%;
      background: transparent;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: #fff;
      border-radius: 50%;
      animation: twinkle 3s infinite;
      box-shadow: 0 0 6px #fff, 0 0 12px #fff;
    }

    @keyframes twinkle {

      0%,
      100% {
        opacity: 0.3;
        transform: scale(1);
      }

      50% {
        opacity: 1;
        transform: scale(1.5);
      }
    }

    .sea {
      position: absolute;
      bottom: 25%;
      width: 100%;
      height: 20%;
      background: linear-gradient(180deg,
          rgba(26, 35, 126, 0.9) 0%,
          rgba(22, 27, 73, 0.95) 50%,
          rgba(15, 20, 51, 1) 100%);
      overflow: hidden;
      backdrop-filter: blur(1px);
    }

    .wave {
      position: absolute;
      top: 0;
      left: -100%;
      width: 200%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.1) 25%,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0.1) 75%,
          transparent 100%);
      animation: waveMove 8s ease-in-out infinite;
    }

    .wave:nth-child(2) {
      animation-delay: 2s;
      opacity: 0.5;
    }

    .wave:nth-child(3) {
      animation-delay: 4s;
      opacity: 0.3;
    }

    @keyframes waveMove {
      0% {
        transform: translateX(0) scaleY(1);
      }

      50% {
        transform: translateX(25%) scaleY(1.2);
      }

      100% {
        transform: translateX(50%) scaleY(1);
      }
    }

    .grass {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 25%;
      background: linear-gradient(180deg,
          #4ade80 0%,
          #22c55e 30%,
          #16a34a 70%,
          #15803d 100%);
      overflow: hidden;
    }

    .grass::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 20px;
      background: repeating-linear-gradient(90deg,
          #4ade80 0px,
          #22c55e 4px,
          #16a34a 8px,
          #4ade80 12px);
      animation: grassWave 4s ease-in-out infinite;
    }

    @keyframes grassWave {

      0%,
      100% {
        transform: scaleX(1);
      }

      50% {
        transform: scaleX(1.05);
      }
    }

    .cloud {
      position: absolute;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .cloud-shape {
      position: relative;
      display: inline-block;
    }

    .cloud-pixel {
      width: 8px;
      height: 8px;
      background: linear-gradient(45deg, #ffffff, #f0f9ff);
      border-radius: 2px;
      display: inline-block;
      margin: 1px;
      animation: cloudPulse 4s ease-in-out infinite;
      box-shadow: 0 2px 4px rgba(255, 255, 255, 0.3);
    }

    @keyframes cloudPulse {

      0%,
      100% {
        opacity: 0.9;
        transform: scale(1);
      }

      50% {
        opacity: 1;
        transform: scale(1.1);
      }
    }

    .cloud1 {
      top: 15%;
      left: 10%;
      animation: cloudMove1 25s linear infinite, float 6s ease-in-out infinite;
    }

    .cloud2 {
      top: 25%;
      left: 60%;
      animation: cloudMove2 30s linear infinite, float 8s ease-in-out infinite;
      animation-delay: 2s;
    }

    .cloud3 {
      top: 35%;
      left: 80%;
      animation: cloudMove3 20s linear infinite, float 7s ease-in-out infinite;
      animation-delay: 5s;
    }

    .cloud4 {
      top: 10%;
      left: 40%;
      animation: cloudMove4 35s linear infinite, float 9s ease-in-out infinite;
      animation-delay: 8s;
    }

    @keyframes cloudMove1 {
      0% {
        transform: translateX(-50px);
      }

      100% {
        transform: translateX(calc(100vw + 50px));
      }
    }

    @keyframes cloudMove2 {
      0% {
        transform: translateX(-80px);
      }

      100% {
        transform: translateX(calc(100vw + 80px));
      }
    }

    @keyframes cloudMove3 {
      0% {
        transform: translateX(-60px);
      }

      100% {
        transform: translateX(calc(100vw + 60px));
      }
    }

    @keyframes cloudMove4 {
      0% {
        transform: translateX(-70px);
      }

      100% {
        transform: translateX(calc(100vw + 70px));
      }
    }

    .particles {
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: radial-gradient(circle, #ffffff 0%, transparent 70%);
      border-radius: 50%;
      animation: particleFloat 15s linear infinite;
    }

    @keyframes particleFloat {
      0% {
        transform: translateY(100vh) translateX(0) rotate(0deg);
        opacity: 0;
      }

      10% {
        opacity: 1;
      }

      90% {
        opacity: 1;
      }

      100% {
        transform: translateY(-20vh) translateX(100px) rotate(360deg);
        opacity: 0;
      }
    }

    .time-indicator {
      position: absolute;
      top: 20px;
      right: 20px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      z-index: 100;
    }

    .ground-details {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 25%;
      background: linear-gradient(180deg,
          transparent 0%,
          rgba(0, 0, 0, 0.1) 50%,
          rgba(0, 0, 0, 0.2) 100%);
      pointer-events: none;
    }

    .reflection {
      position: absolute;
      bottom: 25%;
      width: 100%;
      height: 20%;
      background: linear-gradient(180deg,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 100%);
      mix-blend-mode: overlay;
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {

      0%,
      100% {
        opacity: 0.3;
      }

      50% {
        opacity: 0.7;
      }
    }

    /* --- Original Quiz Styles --- */
    :root {
      --gc-purple: #663399;
      --gc-silver: #b8bcc8;
      --gc-dark: #2a1810;
      --gc-orange: #ff6600;
      --screen-bg: #1a1a2e;
      --screen-glow: #4a69bd;
      --text-light: #e8e8e8;
      --text-dark: #0f0f23;
      --accent: #ff6b35;
      --accent-dark: #cc5529;
      --button-gray: #6c7b7f;
      --button-light: #9ca3af;
    }

    /* Body style modified to inherit background */
    body {
      margin: 0;
      font-family: 'Press Start 2P', monospace;
      color: var(--text-light);
      min-height: 100vh;
      padding: 15px 0;
      /* Add padding for small screens */
    }

    /* --- RESPONSIVE CHANGE: Made the main container fluid --- */
    .gamecube {
      width: 95%;
      /* Use percentage for fluidity */
      max-width: 820px;
      /* Keep the original max size */
      min-width: 300px;
      /* Prevent it from getting too small */
      background: linear-gradient(145deg, var(--gc-purple) 0%, #5a2d91 35%, #4a2570 100%);
      border: 8px solid var(--gc-silver);
      border-radius: 25px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8), inset 0 4px 8px rgba(255, 255, 255, 0.1), inset 0 -4px 8px rgba(0, 0, 0, 0.3);
      padding: 25px;
      position: relative;
      overflow: hidden;
      /* --- Make sure quiz is on top of background elements --- */
      z-index: 10;
    }

    .console-header {
      text-align: center;
      margin-bottom: 20px;
      padding: 12px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.1));
      border-radius: 15px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .console-logo {
      color: var(--gc-orange);
      font-size: 14px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
      letter-spacing: 2px;
    }

    .gaming-area {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .main-screen {
      flex: 1;
      /* Allow screen to grow */
      min-width: 0;
      /* Important for flex items */
      background: linear-gradient(145deg, var(--screen-bg), #16213e);
      border: 6px solid var(--gc-silver);
      border-radius: 20px;
      padding: 18px;
      min-height: 320px;
      box-shadow: inset 0 8px 16px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(74, 105, 189, 0.1), 0 0 30px rgba(74, 105, 189, 0.3);
      position: relative;
      overflow: hidden;
    }

    .main-screen::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, rgba(74, 105, 189, 0.3), rgba(255, 107, 53, 0.2), rgba(74, 105, 189, 0.3));
      border-radius: 20px;
      z-index: -1;
      animation: screenGlow 3s ease-in-out infinite alternate;
    }

    @keyframes screenGlow {
      0% {
        opacity: 0.3;
      }

      100% {
        opacity: 0.7;
      }
    }

    .dialog {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
      border: 3px solid rgba(74, 105, 189, 0.4);
      border-radius: 12px;
      padding: 16px;
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 11px;
      color: var(--text-light);
      box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.1), 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .options {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }

    .option-btn {
      width: 92%;
      background: linear-gradient(145deg, var(--button-gray), var(--button-light));
      color: var(--text-dark);
      border: 3px solid var(--gc-silver);
      border-radius: 12px;
      padding: 10px 8px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: center;
      user-select: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.3);
      position: relative;
    }

    .option-btn:hover {
      transform: translateY(-3px);
      background: linear-gradient(145deg, var(--accent), var(--accent-dark));
      color: var(--text-light);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.2);
    }

    .option-btn:active {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .name-input {
      width: 92%;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      color: var(--text-light);
      border: 3px solid var(--gc-silver);
      border-radius: 12px;
      padding: 10px 8px;
      font-size: 10px;
      text-align: center;
      font-family: 'Press Start 2P', monospace;
      margin: 8px 0;
      box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(74, 105, 189, 0.3);
    }

    .name-input::placeholder {
      color: rgba(232, 232, 232, 0.5);
    }

    .name-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.4), 0 0 12px rgba(255, 107, 53, 0.5);
    }

    .controller-panel {
      width: 140px;
      flex-shrink: 0;
      /* Prevent controller from shrinking */
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .power-indicator {
      width: 100%;
      height: 30px;
      background: linear-gradient(90deg, var(--gc-orange), #ff8533);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 8px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.2);
      animation: powerPulse 2s ease-in-out infinite alternate;
    }

    @keyframes powerPulse {
      0% {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.2);
      }

      100% {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.2), 0 0 20px rgba(255, 102, 0, 0.6);
      }
    }

    .preview-slot {
      width: 100%;
      height: 140px;
      background: linear-gradient(145deg, #2a2a3e, #1a1a2e);
      border: 4px solid var(--gc-silver);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.5), 0 4px 8px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .preview-slot::before {
      content: '';
      position: absolute;
      top: 5px;
      left: 5px;
      right: 5px;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(74, 105, 189, 0.8), transparent);
      animation: scanLine 2s linear infinite;
    }

    @keyframes scanLine {
      0% {
        transform: translateY(0);
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }

      100% {
        transform: translateY(120px);
        opacity: 1;
      }
    }

    .preview-slot img {
      max-width: 100%;
      max-height: 100%;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 10px rgba(74, 105, 189, 0.5));
    }

    .status-display {
      width: 100%;
      background: linear-gradient(145deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.3));
      border: 2px solid var(--gc-silver);
      border-radius: 10px;
      padding: 8px;
      text-align: center;
      font-size: 8px;
      color: var(--text-light);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .typing {
      display: inline-block;
      width: 8px;
      height: 12px;
      background: var(--accent);
      margin-left: 6px;
      vertical-align: middle;
      animation: blink 1s steps(1) infinite;
      box-shadow: 0 0 4px rgba(255, 107, 53, 0.8);
    }

    @keyframes blink {
      50% {
        opacity: 0
      }
    }

    .result-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .result-card {
      width: 100%;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      border: 3px solid rgba(74, 105, 189, 0.6);
      border-radius: 15px;
      padding: 16px;
      text-align: center;
      box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.1), 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .pokemon-name {
      font-size: 12px;
      color: var(--accent);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }

    .trainer-name {
      font-size: 10px;
      color: var(--text-light);
      margin-bottom: 8px;
      opacity: 0.9;
    }

    .restart {
      background: linear-gradient(145deg, var(--gc-orange), #e55a00);
      color: white;
      border: 3px solid var(--gc-silver);
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.15s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.2);
    }

    .restart:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.3);
    }

    .restart:active {
      transform: translateY(0);
    }

    .muted {
      opacity: 0.8;
      font-size: 9px;
      color: var(--text-light);
      margin-top: 8px;
    }

    .result-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
      align-items: center;
    }

    /* New Holo Card Styles (from card2.html) */
    .holo-card-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      font-family: 'PT Sans', sans-serif;
    }

    /* --- RESPONSIVE CHANGE: Made the card fluid --- */
    .pokemon-card {
      width: 95%;
      max-width: 380px;
      /* Original fixed width becomes max-width */
      height: auto;
      /* Allow height to adjust to content */
      min-height: 530px;
      background: #e6e6e6;
      border: 12px solid #f9d71c;
      border-radius: 20px;
      position: relative;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      transition: transform 0.2s ease-out;
      --mx: 0.5;
      --my: 0.5;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, #d3d3d3 25%, #ff8c00 45%);
      position: relative;
      overflow: hidden;
    }

    .card-inner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: repeating-radial-gradient(circle at center, rgba(255, 255, 255, 0.2) 0, rgba(255, 255, 255, 0.2) 1px, transparent 1px, transparent 10px);
      background-size: 20px 20px;
      background-position: 0px 0px;
      mask-image: linear-gradient(to bottom, transparent 30%, black 50%);
      -webkit-mask-image: linear-gradient(to bottom, transparent 30%, black 50%);
      z-index: 1;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .card-inner.interactive::before {
      background-position: calc((var(--mx, 0.5) - 0.5) * 40px) calc((var(--my, 0.5) - 0.5) * 40px);
    }

    .card-inner.is-capturing::before {
      background-image: repeating-radial-gradient(circle at center, rgba(255, 255, 255, 0.4) 0, rgba(255, 255, 255, 0.4) 1px, transparent 1px, transparent 8px);
      background-size: 15px 15px;
      background-position: 0 0;
      opacity: 0.8;
      mix-blend-mode: overlay;
    }

    .card-header,
    .image-container,
    .stats-bar,
    .attacks-section,
    .card-footer {
      position: relative;
      z-index: 2;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      font-family: 'PT Sans', sans-serif;
      font-weight: 700;
      color: black;
    }

    .stage-info {
      font-size: 16px;
    }

    .stage-info .evolves-from {
      font-size: 12px;
      font-weight: 400;
      margin-left: 10px;
      font-style: italic;
    }

    .hp-info {
      display: flex;
      align-items: center;
      font-size: 24px;
    }

    .hp-info .hp-text {
      font-size: 12px;
      font-weight: 400;
      margin-right: 2px;
      position: relative;
      top: -5px;
    }

    .energy-symbol {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #ff4500;
      border: 2px solid white;
      margin-left: 5px;
    }

    .image-container {
      width: 85%;
      /* Use percentage for flexibility */
      max-width: 200px;
      /* Control max image size */
      height: 200px;
      margin: 0 auto;
      border: 4px solid #c0c0c0;
      background-size: cover;
      background-position: center;
    }

    .image-container::before,
    .image-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      pointer-events: none;
    }

    .image-container::before {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.5) 0%, rgba(255, 165, 0, 0.5) 20%, rgba(255, 255, 0, 0.5) 40%, rgba(0, 128, 0, 0.5) 60%, rgba(0, 0, 255, 0.5) 80%, rgba(75, 0, 130, 0.5) 100%);
      mix-blend-mode: hard-light;
    }

    .image-container::after {
      background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.8) 1%, transparent 2%), repeating-radial-gradient(rgba(255, 255, 255, 0.2) 0, rgba(255, 255, 255, 0.2) 1px, transparent 1px, transparent 10px);
      background-size: 40px 40px, 100% 100%;
    }

    .image-container.interactive::after {
      background: radial-gradient(circle at calc(var(--mx, 0.5) * 100%) calc(var(--my, 0.5) * 100%), rgba(255, 255, 255, 0.8) 1%, transparent 2%), repeating-radial-gradient(rgba(255, 255, 255, 0.2) 0, rgba(255, 255, 255, 0.2) 1px, transparent 1px, transparent 10px);
      background-size: 40px 40px, 100% 100%;
    }

    .pokemon-card:hover .image-container::before,
    .pokemon-card:hover .image-container::after {
      opacity: 1;
    }

    .stats-bar {
      background: #c0c0c0;
      text-align: center;
      padding: 2px;
      font-size: 12px;
      font-style: italic;
      color: black;
      margin-top: 5px;
      /* Add a little space */
    }

    .attacks-section {
      padding: 10px 15px;
      color: black;
      /* --- FIX: Added padding-bottom to prevent overlap with the footer --- */
      padding-bottom: 50px;
    }

    .ability {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .ability-name {
      font-weight: 700;
      font-size: 18px;
      margin-left: 10px;
    }

    .ability-tag {
      background: #e74c3c;
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      font-weight: 700;
      clip-path: polygon(0% 0%, 85% 0, 100% 50%, 85% 100%, 0% 100%);
    }

    .ability-description,
    .attack-description {
      font-size: 12px;
      margin: 0;
      font-family: 'PT Sans', sans-serif;
    }

    .attack {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 10px;
    }

    .attack-cost {
      display: flex;
      gap: 5px;
    }

    .attack-cost .energy-symbol {
      width: 20px;
      height: 20px;
    }

    .attack-name {
      font-weight: 700;
      font-size: 18px;
      flex-grow: 1;
      margin-left: 10px;
    }

    .attack-damage {
      font-weight: 700;
      font-size: 18px;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      padding: 10px 15px;
      border-top: 2px solid #c0c0c0;
      font-size: 12px;
      color: black;
      position: absolute;
      /* Position footer at the bottom */
      bottom: 0;
      width: 100%;
      left: 0;
      /* ensure it aligns correctly */
    }

    .footer-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-weight: bold;
    }

    .back-button {
      background: linear-gradient(145deg, #6c7b7f, #9ca3af);
      color: #0f0f23;
      border: 3px solid var(--gc-silver);
      border-radius: 12px;
      padding: 10px 16px;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      cursor: pointer;
      margin-top: 15px;
    }

    .back-button:hover {
      background: linear-gradient(145deg, var(--accent), var(--accent-dark));
      color: white;
    }

    /* --- RESPONSIVE CHANGE: New, more comprehensive media query --- */
    @media (max-width: 768px) {
      .gamecube {
        padding: 15px;
        /* Reduce padding on smaller screens */
      }

      .gaming-area {
        flex-direction: column;
        /* Stack main content and controller */
        gap: 15px;
      }

      .main-screen {
        width: 100%;
        /* Make main screen take full width */
      }

      .controller-panel {
        width: 100%;
        flex-direction: row;
        /* Arrange controller items horizontally */
        justify-content: space-around;
        align-items: center;
      }

      .preview-slot {
        height: 100px;
        width: 100px;
      }

      .dialog {
        font-size: 12px;
        /* Slightly larger text in dialog */
      }
    }

    @media (max-width: 480px) {
      .console-logo {
        font-size: 12px;
        /* Smaller logo on very small screens */
      }

      .dialog {
        padding: 12px;
      }

      .option-btn,
      .name-input,
      .restart,
      .back-button {
        font-size: 9px;
        /* Smaller button text */
        padding: 8px 12px;
      }

      /* Holo card adjustments for small screens */
      .pokemon-card {
        border-width: 8px;
        min-height: 0;
        /* Let height be fully auto */
      }

      .card-header {
        padding: 8px 10px;
      }

      .stage-info {
        font-size: 14px;
      }

      .hp-info {
        font-size: 20px;
      }

      .image-container {
        height: 150px;
      }

      .ability-name,
      .attack-name,
      .attack-damage {
        font-size: 16px;
      }

      .ability-description,
      .attack-description,
      .stats-bar {
        font-size: 11px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Background Elements -->
    <div class="time-indicator"></div>
    <div class="stars" id="stars"></div>
    <div class="particles" id="particles"></div>

    <div class="cloud cloud1">
      <div class="cloud-shape">
        <div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><br><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div>
      </div>
    </div>
    <div class="cloud cloud2">
      <div class="cloud-shape">
        <div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><br><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div>
      </div>
    </div>
    <div class="cloud cloud3">
      <div class="cloud-shape">
        <div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><br><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div>
      </div>
    </div>
    <div class="cloud cloud4">
      <div class="cloud-shape">
        <div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><div class="cloud-pixel"></div><br><div class="cloud-pixel"></div><div class="cloud-pixel"></div>
      </div>
    </div>

    <div class="sea">
      <div class="wave"></div><div class="wave"></div><div class="wave"></div>
    </div>
    <div class="reflection"></div>
    <div class="grass"></div>
    <div class="ground-details"></div>

    <!-- Main Quiz UI (from trial.html) -->
    <div class="gamecube" id="gamecube-console" role="application" aria-label="Pokemon personality quiz">
      <div class="console-header">
        <div class="console-logo">‚óà POK√âMON QUIZ ‚óà</div>
      </div>
      <div class="gaming-area">
        <div class="main-screen" id="screen">
          <div id="quiz-content">
            <div class="dialog" id="dialog">Loading...</div>
            <div class="options" id="options"></div>
          </div>
          <div class="holo-card-container" id="holo-card-container" style="display: none;">
            <div class="pokemon-card" id="pokemon-card">
              <div class="card-inner">
                <div class="card-header">
                  <div class="stage-info" id="card-stage-info"></div>
                  <div class="hp-info"><span class="hp-text">HP</span> <span id="card-hp"></span>
                    <div class="energy-symbol" id="card-energy-symbol"></div>
                  </div>
                </div>
                <div class="image-container" id="card-image-container"></div>
                <div class="stats-bar" id="card-stats-bar"></div>
                <div class="attacks-section">
                  <div class="ability"><span class="ability-tag">Ability</span><span class="ability-name" id="card-ability-name"></span></div>
                  <p class="ability-description" id="card-ability-description"></p>
                  <div class="attack">
                    <div class="attack-cost">
                      <div class="energy-symbol"></div>
                      <div class="energy-symbol"></div>
                    </div>
                    <span class="attack-name" id="card-attack-name"></span>
                    <span class="attack-damage" id="card-attack-damage"></span>
                  </div>
                  <p class="attack-description" id="card-attack-description"></p>
                </div>
                <div class="card-footer">
                  <div class="footer-item"><span>weakness</span><span id="card-weakness"></span></div>
                  <div class="footer-item"><span>resistance</span></div>
                  <div class="footer-item"><span>retreat</span><span id="card-retreat"></span></div>
                </div>
              </div>
            </div>
            <button class="back-button" id="back-to-result">Back to Summary</button>
          </div>
        </div>
        <div class="controller-panel">
          <div class="power-indicator">‚óè ONLINE</div>
          <div class="preview-slot" id="preview">
            <img id="preview-img" src="https://play.pokemonshowdown.com/sprites/ani/pikachu.gif" alt="preview">
          </div>
          <div class="status-display" id="status">Welcome, trainer!</div>
        </div>
      </div>
    </div>
  </div>

  <audio id="select-sound-audio" src="https://rajsshanu.github.io/pokemon/click.mp3" preload="auto"></audio>
  <audio id="victory-sound-audio" src="https://rajsshanu.github.io/pokemon/triumph.mp3" preload="auto"></audio>

  <script>
    // --- Background Script ---
    function createStars() {
      const starsContainer = document.getElementById('stars');
      const starCount = 50;
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 70 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        star.style.animationDuration = (2 + Math.random() * 4) + 's';
        starsContainer.appendChild(star);
      }
    }
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = 20;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 15 + 's';
        particle.style.animationDuration = (10 + Math.random() * 10) + 's';
        particlesContainer.appendChild(particle);
      }
    }
    createStars();
    createParticles();
    let timePhase = 0;
    setInterval(() => {
      timePhase = (timePhase + 1) % 4;
      const indicator = document.querySelector('.time-indicator');
      const phases = ['üåÖ Dawn', '‚òÄÔ∏è Day', 'üåá Dusk', 'üåô Night'];
      indicator.textContent = phases[timePhase];
    }, 5000);

    // --- Quiz Script ---
    /* ============= QUIZ DATA ============= */
    const quizQuestions = [
      { question: "What's your favorite color palette?", options: ["Neon", "Pastal", "Earthy", "Dark tones", "Red", "Blue", "Green", "Yellow", "Orange", "Aqua", "Brown", "Purple"] },
      { question: "Pick your ideal drink:", options: ["Coffee", "Matcha", "Tea", "Juice", "Spicy", "Mild", "Sweet", "Sour"] },
      { question: "What weather do you prefer?", options: ["Sunny", "Rainy", "Cloudy", "Snowy"] },
      { question: "How would you describe your personality?", options: ["Fast", "Calm", "Steady", "Unpredictable"] },
      { question: "Choose your favorite music vibe:", options: ["Rock", "Jazz", "Ambient", "Pop", "Guitar", "Piano", "Flute", "Synthesizer"] },
      { question: "What's your favorite season?", options: ["Summer", "Monsoon", "Spring", "Winter"] },
      { question: "Pick a Pok√©mon item:", options: ["Pok√©ball", "Potion", "Forest", "Rare Candy", "Master Ball", "Berry"] },
      { question: "Choose your ideal environment:", options: ["Mountains", "Ocean", "Meadow", "City", "Volcano", "Waterfall", "Garden", "Skyline", "Laboratory", "Greenhouse"] },
      { question: "Pick your favorite activity:", options: ["Action", "Swimming", "Hiking", "Gaming", "Sprint", "Meditation", "Yoga", "Parkour"] },
      { question: "Choose a mythical creature:", options: ["Dragon", "Dolphin", "Deer", "Tiger", "Phoenix", "Mermaid", "Fairy", "Robot"] },
      { question: "What role suits you best?", options: ["Warrior", "Healer", "Guardian", "Inventor"] },
      { question: "Pick your ideal hangout spot:", options: ["Bonfire", "Lake", "Lightning", "Arcade", "Caf√©", "Greenhouse"] }
    ];

    /* ============ POKEMON CARD DETAILS ============ */
    const pokemonDetails = {
      charizard: { stage: 'STAGE 2', evolvesFrom: 'Evolves from Charmeleon', hp: '170', type: '#ff4500', stats: "NO. 006 Flame Pok√©mon HT: 5'7\" WT: 199.5 lbs.", abilityName: 'Battle Sense', abilityDescription: 'Once during your turn, you may look at the top 3 cards of your deck and put 1 of them into your hand. Discard the other cards.', attackName: 'Royal Blaze', attackDamage: '100+', attackDescription: 'This attack does 50 more damage for each Leon card in your discard pile.', weakness: 'üíß x2', retreat: '‚≠ê ‚≠ê ‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png' },
      blastoise: { stage: 'STAGE 2', evolvesFrom: 'Evolves from Wartortle', hp: '180', type: '#4a90e2', stats: "NO. 009 Shellfish Pok√©mon HT: 5'3\" WT: 188.5 lbs.", abilityName: 'Vitality Spring', abilityDescription: 'Once during your turn, you may search your deck for up to 3 Water Energy cards and attach them to your Pok√©mon in any way you like.', attackName: 'Hydro Pump', attackDamage: '120', attackDescription: 'This attack does 20 more damage for each Water Energy attached.', weakness: '‚ö° x2', retreat: '‚≠ê ‚≠ê ‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/9.png' },
      venusaur: { stage: 'STAGE 2', evolvesFrom: 'Evolves from Ivysaur', hp: '180', type: '#78c850', stats: "NO. 003 Seed Pok√©mon HT: 6'7\" WT: 220.5 lbs.", abilityName: 'Jungle Totem', abilityDescription: 'Your Grass Pok√©mon in play, except for any Venusaur, have no Weakness.', attackName: 'Solar Beam', attackDamage: '120', attackDescription: "This Pok√©mon can't use Solar Beam during your next turn.", weakness: 'üî• x2', retreat: '‚≠ê ‚≠ê ‚≠ê ‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/3.png' },
      pikachu: { stage: 'BASIC', evolvesFrom: '', hp: '60', type: '#f8d030', stats: "NO. 025 Mouse Pok√©mon HT: 1'4\" WT: 13.2 lbs.", abilityName: 'Static', abilityDescription: "If this Pok√©mon is your Active Pok√©mon and is damaged by an opponent's attack, the Attacking Pok√©mon is now Paralyzed.", attackName: 'Thunder Shock', attackDamage: '20', attackDescription: 'Flip a coin. If heads, the Defending Pok√©mon is now Paralyzed.', weakness: 'üêæ x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png' },
      alakazam: { stage: 'STAGE 2', evolvesFrom: 'Evolves from Kadabra', hp: '130', type: '#f85888', stats: "NO. 065 Psi Pok√©mon HT: 4'11\" WT: 105.8 lbs.", abilityName: 'Mind Ruler', abilityDescription: "Prevent all effects of your opponent's attacks, except damage, done to your Benched Pok√©mon.", attackName: 'Zen Spoon', attackDamage: '60x', attackDescription: "This attack does 60 damage for each of your opponent's Benched Pok√©mon.", weakness: 'üêæ x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/65.png' },
      articuno: { stage: 'BASIC', evolvesFrom: '', hp: '120', type: '#98d8d8', stats: "NO. 144 Freeze Pok√©mon HT: 5'7\" WT: 122.1 lbs.", abilityName: 'Ice Wing', abilityDescription: "Discard a Water Energy from this Pok√©mon. The Defending Pok√©mon can't attack during your opponent's next turn.", attackName: 'Blizzard', attackDamage: '110', attackDescription: "This attack does 10 damage to each of your opponent's Benched Pok√©mon.", weakness: '‚öôÔ∏è x2', retreat: '‚≠ê ‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/144.png' },
      onix: { stage: 'BASIC', evolvesFrom: '', hp: '120', type: '#e0c068', stats: "NO. 095 Rock Snake Pok√©mon HT: 28'10\" WT: 463.0 lbs.", abilityName: 'Sturdy', abilityDescription: 'If this Pok√©mon has full HP and would be Knocked Out by damage from an attack, it is not Knocked Out and its remaining HP becomes 10.', attackName: 'Rock Slide', attackDamage: '80', attackDescription: "This attack does 20 damage to 2 of your opponent's Benched Pok√©mon.", weakness: 'üåø x2', retreat: '‚≠ê ‚≠ê ‚≠ê ‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/95.png' },
      umbreon: { stage: 'STAGE 1', evolvesFrom: 'Evolves from Eevee', hp: '110', type: '#2a1810', stats: "NO. 197 Moonlight Pok√©mon HT: 3'3\" WT: 59.5 lbs.", abilityName: 'Dark Signal', abilityDescription: "When you play this Pok√©mon from your hand to evolve 1 of your Pok√©mon, you may switch 1 of your opponent's Benched Pok√©mon with their Active Pok√©mon.", attackName: 'Mean Look', attackDamage: '70', attackDescription: "The Defending Pok√©mon can't retreat during your opponent's next turn.", weakness: 'üåø x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/197.png' },
      gardevoir: { stage: 'STAGE 2', evolvesFrom: 'Evolves from Kirlia', hp: '140', type: '#f098a8', stats: "NO. 282 Embrace Pok√©mon HT: 5'3\" WT: 106.7 lbs.", abilityName: 'Shining Arcana', abilityDescription: 'Once during your turn, you may look at the top 2 cards of your deck and attach any number of basic Energy cards you find there to your Pok√©mon in any way you like.', attackName: 'Brain Wave', attackDamage: '60+', attackDescription: 'This attack does 30 more damage for each Psychic Energy attached to this Pok√©mon.', weakness: '‚öôÔ∏è x2', retreat: '‚≠ê ‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/282.png' },
      togepi: { stage: 'BASIC', evolvesFrom: '', hp: '50', type: '#f0f0f0', stats: "NO. 175 Spike Ball Pok√©mon HT: 1'0\" WT: 3.3 lbs.", abilityName: 'Joyful Gift', abilityDescription: 'Once during your turn, you may heal 10 damage from one of your Benched Pok√©mon.', attackName: 'Charm', attackDamage: '10', attackDescription: "During your opponent's next turn, the Defending Pok√©mon's attacks do 20 less damage.", weakness: '‚öôÔ∏è x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/175.png' },
      jigglypuff: { stage: 'BASIC', evolvesFrom: '', hp: '70', type: '#f8b8f8', stats: "NO. 039 Balloon Pok√©mon HT: 1'8\" WT: 12.1 lbs.", abilityName: 'Lullaby', abilityDescription: 'The Defending Pok√©mon is now Asleep.', attackName: 'Pound', attackDamage: '20', attackDescription: '', weakness: 'üêæ x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/39.png' },
      vulpix: { stage: 'BASIC', evolvesFrom: '', hp: '60', type: '#ee8130', stats: "NO. 037 Fox Pok√©mon HT: 2'0\" WT: 21.8 lbs.", abilityName: 'Roar', abilityDescription: "Your opponent switches their Active Pok√©mon with 1 of their Benched Pok√©mon.", attackName: 'Ember', attackDamage: '30', attackDescription: 'Discard a Fire Energy from this Pok√©mon.', weakness: 'üíß x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/37.png' },
      squirtle: { stage: 'BASIC', evolvesFrom: '', hp: '60', type: '#6890f0', stats: "NO. 007 Tiny Turtle Pok√©mon HT: 1'8\" WT: 19.8 lbs.", abilityName: 'Shell Armor', abilityDescription: 'Prevent all damage done to this Pok√©mon by attacks if it is on the Bench.', attackName: 'Water Gun', attackDamage: '20', attackDescription: '', weakness: 'üåø x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/7.png' },
      piplup: { stage: 'BASIC', evolvesFrom: '', hp: '60', type: '#78c8f0', stats: "NO. 393 Penguin Pok√©mon HT: 1'4\" WT: 11.5 lbs.", abilityName: 'Bubble', abilityDescription: 'Flip a coin. If heads, the Defending Pok√©mon is now Paralyzed.', attackName: 'Peck', attackDamage: '10', attackDescription: '', weakness: '‚ö° x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/393.png' },
      psyduck: { stage: 'BASIC', evolvesFrom: '', hp: '70', type: '#f8d030', stats: "NO. 054 Duck Pok√©mon HT: 2'7\" WT: 43.2 lbs.", abilityName: 'Headache', abilityDescription: "This Pok√©mon can't attack if you have 3 or more cards in your hand.", attackName: 'Scratch', attackDamage: '50', attackDescription: '', weakness: '‚ö° x2', retreat: '‚≠ê', img: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/54.png' }
    };

    /* ============= NEW LOGIC: ANSWER-TO-POKEMON MAPPING ============= */
    const answerToPokemonMap = {
      // Colors
      "Neon": ["pikachu", "alakazam"], "Pastal": ["jigglypuff", "gardevoir"], "Earthy": ["venusaur", "onix"],
      "Dark tones": ["umbreon"], "Red": ["charizard", "vulpix"], "Blue": ["blastoise", "squirtle"],
      "Green": ["venusaur"], "Yellow": ["pikachu"], "Orange": ["vulpix", "charizard"], "Aqua": ["piplup", "articuno"],
      "Brown": ["onix"], "Purple": ["alakazam", "gardevoir"],
      // Drinks
      "Coffee": ["umbreon", "charizard"], "Matcha": ["venusaur"], "Tea": ["gardevoir"], "Juice": ["psyduck", "togepi"],
      "Spicy": ["charizard"], "Mild": ["togepi"], "Sweet": ["jigglypuff"], "Sour": ["pikachu"],
      // Weather
      "Sunny": ["charizard", "venusaur"], "Rainy": ["blastoise", "piplup"], "Cloudy": ["psyduck"], "Snowy": ["articuno"],
      // Personality
      "Fast": ["pikachu"], "Calm": ["gardevoir", "articuno"], "Steady": ["onix", "blastoise"], "Unpredictable": ["alakazam", "psyduck"],
      // Music
      "Rock": ["onix", "charizard"], "Jazz": ["blastoise", "umbreon"], "Ambient": ["articuno"], "Pop": ["jigglypuff", "pikachu"],
      "Guitar": ["vulpix"], "Piano": ["gardevoir"], "Flute": ["togepi"], "Synthesizer": ["alakazam"],
      // Season
      "Summer": ["charizard"], "Monsoon": ["blastoise"], "Spring": ["venusaur", "togepi"], "Winter": ["articuno"],
      // Items
      "Pok√©ball": ["pikachu"], "Potion": ["gardevoir"], "Forest": ["venusaur"], "Rare Candy": ["alakazam"],
      "Master Ball": ["umbreon"], "Berry": ["togepi", "vulpix"],
      // Environment
      "Mountains": ["onix"], "Ocean": ["blastoise"], "Meadow": ["venusaur"], "City": ["pikachu", "umbreon"],
      "Volcano": ["charizard"], "Waterfall": ["squirtle", "piplup"], "Garden": ["gardevoir", "togepi"], "Skyline": ["umbreon"],
      "Laboratory": ["alakazam"], "Greenhouse": ["venusaur"],
      // Activity
      "Action": ["charizard"], "Swimming": ["squirtle", "piplup"], "Hiking": ["onix"], "Gaming": ["pikachu", "psyduck"],
      "Sprint": ["vulpix"], "Meditation": ["alakazam", "gardevoir"], "Yoga": ["gardevoir"], "Parkour": ["alakazam"],
      // Mythical Creature
      "Dragon": ["charizard"], "Dolphin": ["piplup"], "Deer": ["venusaur"], "Tiger": ["vulpix"],
      "Phoenix": ["charizard"], "Mermaid": ["blastoise"], "Fairy": ["togepi", "jigglypuff"], "Robot": ["alakazam"],
      // Role
      "Warrior": ["charizard", "onix"], "Healer": ["gardevoir", "togepi"], "Guardian": ["blastoise", "umbreon"], "Inventor": ["alakazam"],
      // Hangout Spot
      "Bonfire": ["charizard", "vulpix"], "Lake": ["blastoise", "articuno"], "Lightning": ["pikachu"], "Arcade": ["psyduck"],
      "Caf√©": ["jigglypuff", "umbreon"], "Greenhouse": ["venusaur"]
    };

    /* ============= STATE ============= */
    let current = -1;
    let answers = [];
    let userName = "";

    /* ============= DOM ============= */
    const dialogEl = document.getElementById('dialog');
    const optionsEl = document.getElementById('options');
    const previewImg = document.getElementById('preview-img');
    const statusEl = document.getElementById('status');
    const quizContentEl = document.getElementById('quiz-content');
    const holoCardContainerEl = document.getElementById('holo-card-container');
    const pokemonCardEl = document.getElementById('pokemon-card');

    /* ============= TYPING EFFECT ============= */
    function typeText(text, cb) {
      dialogEl.innerHTML = '';
      let i = 0;
      const span = document.createElement('span');
      dialogEl.appendChild(span);
      const caret = document.createElement('span');
      caret.className = 'typing';
      dialogEl.appendChild(caret);

      const speed = 18;
      function step() {
        if (i <= text.length) {
          span.textContent = text.slice(0, i);
          i++;
          setTimeout(step, speed);
        } else {
          caret.remove();
          if (cb) cb();
        }
      }
      step();
    }

    /* ============= NAME INPUT SCREEN ============= */
    function showNameInput() {
      typeText("Welcome to the Pok√©mon Personality Quiz! What's your name, trainer?", () => { });

      optionsEl.innerHTML = '';
      const nameInput = document.createElement('input');
      nameInput.className = 'name-input';
      nameInput.type = 'text';
      nameInput.placeholder = 'Enter your name';
      nameInput.maxLength = 15;

      const startBtn = document.createElement('button');
      startBtn.className = 'option-btn';
      startBtn.textContent = 'Start Quiz';
      startBtn.onclick = () => {
        const name = nameInput.value.trim();
        if (name) {
          playSelectSound();
          userName = name;
          current = 0;
          setTimeout(loadQuestion, 300);
        } else {
          nameInput.style.borderColor = '#ff4444';
          setTimeout(() => nameInput.style.borderColor = 'var(--gc-silver)', 1000);
        }
      };

      nameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') startBtn.click(); });

      optionsEl.appendChild(nameInput);
      optionsEl.appendChild(startBtn);

      setTimeout(() => nameInput.focus(), 100);
      statusEl.textContent = "Enter your trainer name";
    }

    /* ============= LOAD / SHOW QUESTION ============= */
    function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[a[i], a[j]] = [a[j], a[i]] } return a }

    function loadQuestion() {
      const q = quizQuestions[current];
      typeText(q.question, () => { });
      optionsEl.innerHTML = '';
      const opts = shuffle([...q.options]);
      opts.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = opt;
        btn.onclick = () => {
          playSelectSound();
          selectAnswer(opt);
        };
        optionsEl.appendChild(btn);
      });
      previewImg.src = getPreviewForQuestion(current);
      statusEl.textContent = `Question ${current + 1} / ${quizQuestions.length}`;
    }

    function getPreviewForQuestion(index) {
      const pool = ['pikachu', 'togepi', 'vulpix', 'squirtle', 'piplup', 'jigglypuff', 'psyduck', 'charizard', 'blastoise', 'venusaur', 'alakazam', 'onix', 'umbreon', 'gardevoir', 'articuno'];
      return `https://play.pokemonshowdown.com/sprites/ani/${pool[index % pool.length]}.gif`;
    }

    function selectAnswer(option) {
      answers.push(option);
      previewImg.style.transform = 'scale(0.94)';
      setTimeout(() => previewImg.style.transform = '', 140);
      current++;
      if (current < quizQuestions.length) {
        setTimeout(loadQuestion, 220);
      } else {
        setTimeout(showResult, 300);
      }
    }

    /* ============= POK√©MON SCORING LOGIC (COLOR PRIORITY) ============= */
    function getPokemon(answers) {
        const points = { charizard: 0, blastoise: 0, venusaur: 0, pikachu: 0, alakazam: 0, articuno: 0, onix: 0, umbreon: 0, gardevoir: 0, togepi: 0, jigglypuff: 0, vulpix: 0, squirtle: 0, piplup: 0, psyduck: 0 };

        // 1. Calculate a score for all pok√©mon based on all answers.
        answers.forEach(answer => {
            const associatedPokemon = answerToPokemonMap[answer];
            if (associatedPokemon) {
                associatedPokemon.forEach(pokemon => {
                    if (points.hasOwnProperty(pokemon)) {
                        points[pokemon]++;
                    }
                });
            }
        });

        // 2. Identify the Pok√©mon related to the user's color choice.
        const colorAnswer = answers[0]; // From "What's your favorite color palette?"
        const colorPriorityGroup = answerToPokemonMap[colorAnswer] || [];
        
        // 3. If the color choice doesn't map to any Pok√©mon, fall back to the highest overall score.
        if (colorPriorityGroup.length === 0) {
            let maxScore = -1;
            let winners = [];
            for (const pokemon in points) {
                if (points[pokemon] > maxScore) {
                    maxScore = points[pokemon];
                    winners = [pokemon];
                } else if (points[pokemon] === maxScore) {
                    winners.push(pokemon);
                }
            }
            return winners[Math.floor(Math.random() * winners.length)] || 'pikachu';
        }
        
        // 4. Find the highest-scoring Pok√©mon THAT IS ALSO in the color priority group.
        let bestMatch = '';
        let highestScoreInGroup = -1;
        let tieBreakerList = [];

        // Iterate through the priority list to find the best candidate based on the full scoring.
        colorPriorityGroup.forEach(pokemon => {
            const score = points[pokemon];
            if (score > highestScoreInGroup) {
                highestScoreInGroup = score;
                tieBreakerList = [pokemon]; // Start a new list of winners
            } else if (score === highestScoreInGroup) {
                tieBreakerList.push(pokemon); // Add to the list of tied winners
            }
        });
        
        // 5. If there's a tie among the preferred Pok√©mon, pick one randomly.
        if (tieBreakerList.length > 0) {
            const randomIndex = Math.floor(Math.random() * tieBreakerList.length);
            return tieBreakerList[randomIndex];
        }

        // Fallback: if no scored Pok√©mon were in the priority list (unlikely), just pick one from that list.
        return colorPriorityGroup[Math.floor(Math.random() * colorPriorityGroup.length)];
    }


    /* ============= RESULT / UI ============= */
    function showResult() {
      const pokemonKey = getPokemon(answers);
      const prettyName = pokemonKey.charAt(0).toUpperCase() + pokemonKey.slice(1);

      dialogEl.innerHTML = '';
      optionsEl.innerHTML = '';

      const rs = document.createElement('div');
      rs.className = 'result-screen';

      const card = document.createElement('div');
      card.className = 'result-card';
      card.innerHTML = `
    <div class="trainer-name">Trainer ${userName}</div>
    <div class="pokemon-name">Your Pok√©mon is: ${prettyName}!</div>
    <img src="https://play.pokemonshowdown.com/sprites/ani/${pokemonKey}.gif" alt="${prettyName}" style="max-width:200px; image-rendering:pixelated;">
    <div class="muted">${getPersonalityBlurb(pokemonKey)}</div>
  `;

      const buttonsContainer = document.createElement('div');
      buttonsContainer.className = 'result-buttons';

      const previewBtn = document.createElement('button');
      previewBtn.className = 'restart'; // reuse style
      previewBtn.textContent = 'Preview Holo Card';
      previewBtn.onclick = () => {
        playSelectSound();
        previewHoloCard(pokemonKey, userName);
      };

      const downloadBtn = document.createElement('button');
      downloadBtn.className = 'restart';
      downloadBtn.textContent = 'Download Holo Card (PNG)';
      downloadBtn.onclick = () => {
        playSelectSound();
        downloadHoloCard(pokemonKey, userName);
      };

      const restartBtn = document.createElement('button');
      restartBtn.className = 'restart';
      restartBtn.textContent = 'Take Quiz Again';
      restartBtn.onclick = () => { playSelectSound(); resetQuiz(); };

      buttonsContainer.appendChild(previewBtn);
      buttonsContainer.appendChild(downloadBtn);
      buttonsContainer.appendChild(restartBtn);

      rs.appendChild(card);
      rs.appendChild(buttonsContainer);
      optionsEl.appendChild(rs);

      setTimeout(() => playVictorySound(), 500);
      previewImg.src = `https://play.pokemonshowdown.com/sprites/ani/${pokemonKey}.gif`;
      statusEl.textContent = `Result: ${prettyName}`;
    }

    /* ============= HOLO CARD FUNCTIONS ============= */

    function populateHoloCard(pokemonKey, trainerName, cardEl = pokemonCardEl) {
      const details = pokemonDetails[pokemonKey];
      if (!details) return;

      // Use querySelector on the provided element to avoid conflicts with cloned nodes
      cardEl.querySelector('#card-stage-info').innerHTML = `${details.stage} <span class="evolves-from">${details.evolvesFrom}</span>`;
      cardEl.querySelector('#card-hp').textContent = details.hp;
      cardEl.querySelector('#card-energy-symbol').style.backgroundColor = details.type;
      cardEl.querySelector('#card-image-container').style.backgroundImage = `url('${details.img}')`;
      cardEl.querySelector('#card-stats-bar').textContent = details.stats;
      cardEl.querySelector('#card-ability-name').textContent = details.abilityName;
      cardEl.querySelector('#card-ability-description').textContent = details.abilityDescription;
      cardEl.querySelector('#card-attack-name').textContent = details.attackName;
      cardEl.querySelector('#card-attack-damage').textContent = details.attackDamage;
      cardEl.querySelector('#card-attack-description').textContent = details.attackDescription;
      cardEl.querySelector('#card-weakness').textContent = details.weakness;
      cardEl.querySelector('#card-retreat').textContent = details.retreat;
    }

    function previewHoloCard(pokemonKey, userName) {
      quizContentEl.style.display = 'none';
      holoCardContainerEl.style.display = 'flex';

      populateHoloCard(pokemonKey, userName, pokemonCardEl);

      // Enable interactive effects
      const cardInner = pokemonCardEl.querySelector('.card-inner');
      const imageContainer = pokemonCardEl.querySelector('.image-container');
      cardInner.classList.add('interactive');
      imageContainer.classList.add('interactive');

      // Attach mouse move listeners for interactive effect
      pokemonCardEl.addEventListener('mousemove', handleCardMouseMove);
      pokemonCardEl.addEventListener('mouseleave', handleCardMouseLeave);
    }

    document.getElementById('back-to-result').onclick = () => {
      playSelectSound();
      holoCardContainerEl.style.display = 'none';
      quizContentEl.style.display = 'block';

      // Clean up listeners and interactive classes
      pokemonCardEl.removeEventListener('mousemove', handleCardMouseMove);
      pokemonCardEl.removeEventListener('mouseleave', handleCardMouseLeave);
      pokemonCardEl.style.transform = ''; // Reset transform

      const cardInner = pokemonCardEl.querySelector('.card-inner');
      const imageContainer = pokemonCardEl.querySelector('.image-container');
      cardInner.classList.remove('interactive');
      imageContainer.classList.remove('interactive');
    };

    function handleCardMouseMove(e) {
      const rect = pokemonCardEl.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = (y - centerY) / 20;
      const rotateY = (centerX - x) / 20;
      pokemonCardEl.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;

      // Ensure valid values for CSS custom properties (clamp between 0 and 1)
      const mx = Math.max(0, Math.min(1, isFinite(x / rect.width) ? x / rect.width : 0.5));
      const my = Math.max(0, Math.min(1, isFinite(y / rect.height) ? y / rect.height : 0.5));
      pokemonCardEl.style.setProperty('--mx', mx.toString());
      pokemonCardEl.style.setProperty('--my', my.toString());
    }

    function handleCardMouseLeave() {
      pokemonCardEl.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg)';
    }

    async function downloadHoloCard(pokemonKey, userName) {
      // Create a clone of the card to render off-screen, avoiding modification of the live element.
      const cardToRender = pokemonCardEl.cloneNode(true);
      cardToRender.id = 'pokemon-card-for-render'; // Avoid duplicate IDs in the DOM

      // Populate the clone with the correct data.
      populateHoloCard(pokemonKey, userName, cardToRender);

      // Style the clone for a static, clean capture.
      cardToRender.style.transform = 'none';
      cardToRender.style.position = 'absolute';
      cardToRender.style.left = '-9999px'; // Position it off-screen
      cardToRender.style.top = '0';

      const cardInner = cardToRender.querySelector('.card-inner');
      const imageContainer = cardToRender.querySelector('.image-container');

      // Remove interactive classes and add the static capturing class.
      cardInner.classList.remove('interactive');
      imageContainer.classList.remove('interactive');
      cardInner.classList.add('is-capturing');

      // Add the clone to the document body for rendering.
      document.body.appendChild(cardToRender);

      // Allow a moment for the browser to render the off-screen element.
      setTimeout(() => {
        html2canvas(cardToRender, {
          scale: 2,
          useCORS: true,
          backgroundColor: null,
          allowTaint: true, // Necessary for cross-origin images
        }).then(canvas => {
          const link = document.createElement('a');
          const safeName = (userName || 'trainer').replace(/[^a-z0-9_-]/gi, '_');
          link.download = `${safeName}_${pokemonKey}_card.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
          link.remove();
        }).catch(err => {
          console.error("Oops, could not create card image!", err);
          alert('Sorry ‚Äî could not generate the PNG. This may be a browser-specific issue with canvas rendering.');
        }).finally(() => {
          // --- CLEAN UP AFTER CAPTURE ---
          // Remove the off-screen clone from the document.
          document.body.removeChild(cardToRender);
        });
      }, 300); // A generous delay to ensure rendering is complete.
    }

    /* ============= SHORT BLURB PER POK√©MON ============= */
    function getPersonalityBlurb(key) {
      const blurbs = {
        charizard: "Fiery and adventurous ‚Äî you take charge and love action.",
        blastoise: "Steady and loyal ‚Äî calm under pressure and dependable.",
        venusaur: "Grounded and nurturing ‚Äî connected to nature and steady growth.",
        pikachu: "Energetic and playful ‚Äî sparks fly where you go.",
        togepi: "Sweet-hearted and wholesome ‚Äî you brighten small moments.",
        jigglypuff: "Creative and dramatic ‚Äî you love to perform and charm.",
        vulpix: "Graceful and warm ‚Äî elegance with a spark of mischief.",
        squirtle: "Cool and playful ‚Äî easygoing with a cheeky streak.",
        piplup: "Proud and stylish ‚Äî confident with a soft heart.",
        psyduck: "Quirky and unpredictable ‚Äî delightfully confusing at times.",
        alakazam: "Insightful and clever ‚Äî your mind solves puzzles others can't.",
        gardevoir: "Protective and empathetic ‚Äî you feel deeply and care for others.",
        onix: "Sturdy and resilient ‚Äî strong, reliable, and unshakable.",
        umbreon: "Mysterious and composed ‚Äî calm, cool, and quietly powerful.",
        articuno: "Calm and majestic ‚Äî cool-headed with a serene presence."
      };
      return blurbs[key] || "A unique spirit ‚Äî this Pok√©mon matches your vibe!";
    }

    /* ============= RESET ============= */
    function resetQuiz() {
      current = -1;
      answers = [];
      userName = "";

      quizContentEl.style.display = 'block';
      holoCardContainerEl.style.display = 'none';
      dialogEl.innerHTML = '';
      optionsEl.innerHTML = '';

      previewImg.src = 'https://play.pokemonshowdown.com/sprites/ani/pikachu.gif';
      statusEl.textContent = 'Welcome, trainer!';

      setTimeout(() => { showNameInput(); }, 100);
    }

    /* ============= RETRO SOUND EFFECTS ============= */

    function playSelectSound() {
      const sound = document.getElementById('select-sound-audio');
      if (sound) {
        sound.currentTime = 0; // Rewind to the start
        sound.play().catch(error => {
          console.log("Audio playback failed. User may need to interact with the page first.", error);
        });
      }
    }

    function playVictorySound() {
      const sound = document.getElementById('victory-sound-audio');
      if (sound) {
        sound.currentTime = 0; // Rewind to the start
        sound.play().catch(error => {
          console.log("Victory audio playback failed.", error);
        });
      }
    }

    /* ============= START ============= */
    showNameInput();
  </script>
</body>

</html>```
